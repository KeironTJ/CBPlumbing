{% extends "layout.html" %}
{% block content %}

<h2 class="title-card"><a href="{{ url_for('dash') }}">Dashboard</a> ->  <a href="{{ url_for('view_all_jobs') }}"> {{ title }} </a> -> {{ subtitle }} </h2>


<div class="title-card">
    <h3 class="title-card"> Job ID: {{ job.id }} - Header</h3>

    <form action="" method="post" novalidate>
        {{ form.hidden_tag() }}
        <table class="table table-striped table-card">
            <tr>
                <th>{{ form.customer_id.label }}</th>
                <th>{{ form.job_type.label }}</th>
                <th>{{ form.job_status.label }}</th>
                <th>{{ form.job_planned_date.label }}</th>
                <th>{{ form.invoice_status.label }}</th>

            </tr>
            <tr>
                <td>{{ form.customer_id }}</td>
                <td>{{ form.job_type }}</td>
                <td>{{ form.job_status }}</td>
                <td>{{ form.job_planned_date }}</td>
                <td>{{ form.invoice_status }}</td>
            </tr>
            <tr>
                <td>{% for error in form.customer_id.errors %}<span style="color: red;">[{{ error }}]</span>{% endfor %}</td>
                <td>{% for error in form.job_type.errors %}<span style="color: red;">[{{ error }}]</span>{% endfor %}</td>
                <td>{% for error in form.job_status.errors %}<span style="color: red;">[{{ error }}]</span>{% endfor %}</td>
                <td>{% for error in form.job_planned_date.errors %}<span style="color: red;">[{{ error }}]</span>{% endfor %}</td>
                <td>{% for error in form.invoice_status.errors %}<span style="color: red;">[{{ error }}]</span>{% endfor %}</td>
            </tr>
        </table>

        <div class="title-card">
            <p>{{ form.job_notes.label }}<br>{{ form.job_notes(size=32) }}</p>
            <p>{% for error in form.job_notes.errors %}<span style="color: red;">[{{ error }}]</span>{% endfor %}</p>
        </div>

        <p>
            
            <a class="btn btn-default" href="{{ url_for('view_all_jobs') }}">&laquo; Back to Jobs</a>
            {{ form.submit(class_="btn btn-primary") }}
            
        </p>        
        
    </form>
</div>

<div class="title-card">
    <h3 class="title-card"> Items </h3>

    <table class="table table-striped table-card">
        <tr>
            <th>Item Name</th>
            <th>Item Description</th>
            <th>Item Quantity</th>
            <th>Item Cost</th>
            <th>Total Cost</th>
            <th>Actions</th>
        </tr>
        {% for item in items %}
        <tr>
            <td>{{ item.item_name }}</td>
            <td>{{ item.item_description }}</td>
            <td>{{ item.item_quantity }}</td>
            <td>£{{ '%.2f'|format(item.item_cost) }}</td>
            <td>£{{ '%.2f'|format(item.item_total) }}</td>
            <td>
                <div style="display: flex; gap: 5px;">
                    <a class="btn btn-primary" href="{{ url_for('edit_job_item', job_id=job.id, item_id=item.id) }} ">Edit &raquo;</a>
                    <form method="POST" action="{{ url_for('delete_job_item', item_id=item.id) }}" onclick="return confirm('Are you sure you want to delete this item?')">
                        <input type="submit" value="Delete" class="btn btn-danger">
                    </form>
                </div>
            </td>

        </tr>
        {% endfor %}


    </table>

    <p>
        <a class="btn btn-primary" href="{{ url_for('add_job_item', job_id=job.id) }} ">Add Item &raquo;</a>
    </p>
    

    <div>
        <p>
            <strong>Total Cost: £{{ '%.2f'|format(total_cost or 0) }}</strong>
        </p>
    </div>




</div>

<div style="display: flex; " >
    <a style ="margin-right: 5px; " class="btn btn-default" href="{{ url_for('view_all_jobs') }}">&laquo; Back to Jobs</a>
    <a style ="margin-right: 5px; "class="btn btn-primary" href="{{ url_for('view_job', job_id=job.id) }} ">View Job &raquo;</a>
    <form method="POST" action="{{ url_for('delete_job', job_id=job.id) }}" onsubmit="return confirm('Are you sure you want to delete this job?')">
        <input type="hidden" name="_method" value="DELETE">
        <button type="submit" class="btn btn-danger">Delete Job</button>
    </form>
</div>

{% endblock %}
